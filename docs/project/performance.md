# 성능 테스트

## 포인트 충전, 사용 API

- 하나의 row 에 대한 update 시 pessimistic lock 으로 인한 대기가 발생한다.
- db에 부담이 될만한 시나리오는 존재하지 않는다.   
  lock 으로 길게 대기하는 상황은 유저 한 명이 충전과 사용을 동시에 반복적으로 시도하는 경우이기 때문이다.

---

## 주문 API

### 시나리오 1: 한정 수량 타임딜

> 시나리오  
> 상품 재고가 100개 있고, 10만명의 유저가 동시에 구매를 하려고 시도하는 경우

> 기존 동시성 제어 방식  
> DB Pessimistic Lock

1. 재고를 조회하는 유저 (주문 API 시도 전)
2. 재고 차감을 시도하하는 유저
    1. 재고 차감에 성공하는 경우 (주문 API 성공)
    2. 재고 차감에 실패하는 경우
        1. 재고가 없는 경우 (주문 API 실패)
        2. 재고 차감을 위한 lock 을 획득하기 위해 대기가 오래 걸리는 경우

#### 검증해야 할 것

- 기존의 동시성 제어 방식에 따라, 동시성이 올바르게 처리되는지 확인 필요 => **Load Test**
- 재고 차감을 위해서 건 lock이 db리소스를 너무 많이 쓰지 않는지 => **Load Test**
- lock 을 대기하는 시간이 얼마나 오래 걸리는지, 적절한 방식으로 응답을 내려줄 수 있는지 확인 필요.

### 시나리오 2: 세일 기간

> 시나리오
> 2주일의 세일 기간 동안, 평소보다 100% 이상 증가한 주문 요청 건을 처리하는 경우

- 지속적으로 증가된 부하에도 적절한 latency로 응답하는지 확인 필요 => **Endurance Test**

---

## 결제 API

### 시나리오: 한정 수량 타임딜

1. 결제에 성공하는 유저
2. 결제에 실패하는 유저
    1. 결제를 위한 외부 서비의 호출에 실패하는 경우
    2.
