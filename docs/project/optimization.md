# 쿼리 최적화


## 상품 목록 조회 - Index & Cache
### Why?
- 검색 조건에 해당하는 이름, 카테고리 등의 컬럼에 index 를 설정하면 조회 성능을 올릴 수 있다. 
이 때, 카디널리티가 높은 순서로 index 가 등록되어야 한다. (이름>카테고리)
- 상품은 자주 추가되지 않는다. 자주 요청되므로 동일 쿼리에 대해 cache 를 사용하는 것이 좋다.

## 인기 상품 랭킹 조회 - Batch & Cache
- 현재 인기 상품 조회 API 는 직접 Join 하여 판매량을 계산하고 있으므로, 대규모 트래픽 요청 시 캐싱을 하더라도 성능에 문제가 발생할 수 있다.
- 따라서, 통계용 테이블과 Batch 시스템을 활용하여 주기적으로 인기 상품을 업데이트하는 방식을 사용하는 것이 좋다.
- 이 때, Batch 시스템은 주기적으로 통계용 테이블을 업데이트하고, 인기 상품 조회 API 는 통계용 테이블을 조회하도록 변경한다.
- 자주 요청되므로 동일 쿼리에 대해 cache 를 사용한다.
- 랭킹 집계 조회 기간에 따라 Batch process 와, cache 정합성 관리 주기를 조정한다.
  - 실시간의 경우 30분, 1시간 간격으로 집계 및 cache 업데이트